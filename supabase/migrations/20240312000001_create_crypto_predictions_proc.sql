create or replace function create_crypto_predictions_table()
returns void
language plpgsql
security definer
as $$
begin
  create table if not exists public.crypto_predictions (
    id bigint generated by default as identity primary key,
    symbol text not null,
    predictions jsonb not null,
    timestamp timestamptz not null default now(),
    created_at timestamptz not null default now()
  );

  -- Enable RLS
  alter table public.crypto_predictions enable row level security;

  -- Try to create policy, ignore error if it exists
  begin
    create policy "Allow all operations for authenticated users"
      on public.crypto_predictions
      for all
      to authenticated
      using (true)
      with check (true);
  exception when duplicate_object then
    -- do nothing, policy already exists
  end;
end;
$$; 